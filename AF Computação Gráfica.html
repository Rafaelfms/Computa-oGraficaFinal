var createScene = function () {
	
    var scene = new BABYLON.Scene(engine);

	var camera = new BABYLON.ArcRotateCamera("Camera",1.3, 1.4, 300, BABYLON.Vector3.Zero(), scene);

	camera.attachControl(canvas, true);

	var light = new BABYLON.HemisphericLight("hemi", new BABYLON.Vector3(0, 1, 0), scene);

    let holder = BABYLON.MeshBuilder.CreateSphere("holder", {diameter: 2, segments: 4}, scene);
	let wheel = BABYLON.MeshBuilder.CreateSphere("base", {diameterY: 10, diameterZ: 1, diameterX: 10}, scene);

    let box1 = BABYLON.MeshBuilder.CreateBox("tooth1", {width: 5.5, height:0.5, depth:3}, scene);
    box1.parent = wheel;
    box1.position.x = 7;

    let box2 = box1.clone("tooth2");
    box2.position.x = -7;

    let box3 = box1.clone("tooth3");
    box3.position.x = 0;
    box3.position.y = 7;
    box3.rotation.z = Math.PI / 2;

    box4 = box3.clone("tooth4");
    box4.position.y = -7;

    // grounds
    let ground1 = BABYLON.MeshBuilder.CreateBox("ground", {width: 20, height: .5,depth:4}, scene);
    ground1.position.y = 12;
    ground1.position.x = -12;
    ground1.rotation.z = -0.2;

    let ground2 = BABYLON.MeshBuilder.CreateBox("ground", {width: 20, height: .5,depth:4}, scene);
    ground2.position.y = 17;
    ground2.position.x = 10;
    ground2.rotation.z = 0.2;

    let ground3 = BABYLON.MeshBuilder.CreateBox("ground", {width: 20, height: .5,depth:4}, scene);
    ground3.position.y = 22;
    ground3.position.x = -10;
    ground3.rotation.z = -0.2;

    let ground4 = BABYLON.MeshBuilder.CreateBox("ground", {width: 50, height: 1,depth:15}, scene);
    ground4.position.y = -62;
    ground4.position.x = 60;
    ground4.rotation.z = 0;
    
    let ground5 = BABYLON.MeshBuilder.CreateBox("ground", {width: 20, height: .5,depth:4}, scene);
    ground5.position.y = 27;
    ground5.position.x = 10;
    ground5.rotation.z = 0.2;

    let ground6 = BABYLON.MeshBuilder.CreateBox("ground", {width: 0.5, height: 15,depth:4}, scene);
    ground6.position.y = 36;
    ground6.position.x = 20;
    ground6.rotation.z = 0;

    let ground10 = BABYLON.MeshBuilder.CreateBox("ground", {width: 20, height: 1,depth:4}, scene);
    ground10.position.y = 22;
    ground10.position.x = -50;
    ground10.rotation.z = 0;


    let ground16 = BABYLON.MeshBuilder.CreateBox("ground", {width: 40, height: .5,depth:6}, scene);
    ground16.position.y = -40;
    ground16.position.x = -10;
    ground16.rotation.z = 2.2;
    


    //planks
    let plank1 = BABYLON.MeshBuilder.CreateBox("plank", {width: 0.5, height: 3,depth:2}, scene);
    plank1.position.y = -60;
    plank1.position.x = 40;
    plank1.rotation.z = 0;

    let plank2 = BABYLON.MeshBuilder.CreateBox("plank", {width: 0.5, height: 5,depth:3}, scene);
    plank2.position.y = -59;
    plank2.position.x = 41.5;
    plank2.rotation.z = 0;

    let plank3 = BABYLON.MeshBuilder.CreateBox("plank", {width: 0.5, height: 8,depth:4}, scene);
    plank3.position.y = -58;
    plank3.position.x = 44;
    plank3.rotation.z = 0;

    let plank4 = BABYLON.MeshBuilder.CreateBox("plank", {width: 0.5, height: 12,depth:5}, scene);
    plank4.position.y = -55;
    plank4.position.x = 48;
    plank4.rotation.z = 0;

    let plank5 = BABYLON.MeshBuilder.CreateBox("plank", {width: 0.5, height: 17,depth:6}, scene);
    plank5.position.y = -52;
    plank5.position.x = 54;
    plank5.rotation.z = 0;

    let plank6 = BABYLON.MeshBuilder.CreateBox("plank", {width: 0.5, height: 23,depth:7}, scene);
    plank6.position.y = -49;
    plank6.position.x = 62.5;
    plank6.rotation.z = 0;

    let plank7 = BABYLON.MeshBuilder.CreateBox("plank", {width: 0.5, height: 30,depth:8}, scene);
    plank7.position.y = -46;
    plank7.position.x = 74;
    plank7.rotation.z = 0;

    //balls
    function ballPosition(ball) {
        ball.position.y = 30;
        ball.position.x = -10;
    }

    let ball = BABYLON.MeshBuilder.CreateSphere("ball", {diameter: 2, segments: 4}, scene);
    ballPosition(ball);
    let balls = [ball];

    let ground7 = BABYLON.MeshBuilder.CreateBox("ground", {width: 10, height: .5,depth:50}, scene);
	ground7.position.y = -60;
    ground7.position.x = 11;
    ground7.position.z = 0;
    ground7.rotation.y=Math.PI/2;
    let ground8 = BABYLON.MeshBuilder.CreateBox("ground", {width: .5, height: 10,depth:50}, scene);
	ground8.position.y = -55;
    ground8.position.x = 11;
    ground8.position.z = -5;
    ground8.rotation.y=Math.PI/2;
    let ground9 = BABYLON.MeshBuilder.CreateBox("ground", {width: .5, height: 10,depth:50}, scene);
	ground9.position.y = -55;
    ground9.position.x = 11;
    ground9.position.z = 5;
    ground9.rotation.y=Math.PI/2;

    let ground17 = BABYLON.MeshBuilder.CreateBox("ground", {width: 30, height: 0.5,depth:5}, scene);
	ground17.position.y = -55;
    ground17.position.x = 115;
    ground17.position.z = 0;
    
    let cylinder1 = BABYLON.MeshBuilder.CreateCylinder("ground", {diameter: 5, height: 5}, scene);
	cylinder1.position.y = -58;
    cylinder1.position.x = 115;
    cylinder1.rotation.z = Math.PI/2;
    cylinder1.rotation.y = Math.PI/2;

    let bigball = BABYLON.MeshBuilder.CreateSphere("ball", {diameter:9});
    bigball.position.x= 22;
    bigball.position.y= -57;
    bigball.position.z= 0;

    let ball2 = BABYLON.MeshBuilder.CreateSphere("ball", {diameter:2});
    ball2.position.x= 125;
    ball2.position.y= -54;
    ball2.position.z= 0;

    let ground18 = BABYLON.MeshBuilder.CreateBox("ground", {width: 20, height: 0.5,depth:5}, scene);
	ground18.position.y = -20;
    ground18.position.x = 90;
    ground18.rotation.z = -0.4;

    // physics

    // cannon vs. oimo
    let cannon = true;
    let forceFactor = cannon ? 1 : 1500; 
    scene.enablePhysics(null, new BABYLON.AmmoJSPlugin());
    // impostors for the blades
    [box1, box2, box3, box4].forEach((mesh) => {
        mesh.physicsImpostor = new BABYLON.PhysicsImpostor(mesh, BABYLON.PhysicsImpostor.BoxImpostor, {mass: 0});
    });

    // the wheel
    wheel.physicsImpostor = new BABYLON.PhysicsImpostor(wheel, BABYLON.PhysicsImpostor.SphereImpostor, {mass: 10});

    // the planks
    [plank1, plank2, plank3, plank4, plank5, plank6, plank7,ground17].forEach((mesh) => {
    mesh.physicsImpostor = new BABYLON.PhysicsImpostor(mesh, BABYLON.PhysicsImpostor.BoxImpostor, {mass: 6});
    });

    
    // the center mesh that turns the wheel
    holder.physicsImpostor = new BABYLON.PhysicsImpostor(holder, BABYLON.PhysicsImpostor.SphereImpostor, {mass: 0});

    // bigball
    bigball.physicsImpostor = new BABYLON.PhysicsImpostor(bigball, BABYLON.PhysicsImpostor.SphereImpostor, {mass: 10});

    // ball2
    ball2.physicsImpostor = new BABYLON.PhysicsImpostor(ball2, BABYLON.PhysicsImpostor.SphereImpostor, {mass: 0.5});


    var joint1 = new BABYLON.HingeJoint({  
        mainPivot: new BABYLON.Vector3(0, 0, 0),
        connectedPivot: new BABYLON.Vector3(0, 0, 0),
        mainAxis: new BABYLON.Vector3(0, 0, -1),
        connectedAxis: new BABYLON.Vector3(0, 0, -1),
        nativeParams: {
        }
    });
    // add the joint and the motor
    holder.physicsImpostor.addJoint(wheel.physicsImpostor, joint1);  

    // spinning
    joint1.setMotor(1 * forceFactor, 20 * forceFactor);


    // impostors for the ground objects
    [ground1,ground18,ground2,ground3,ground4,ground5,ground6,ground7,ground8,ground9,ground10,ground16,cylinder1].forEach(ground => {
        ground.physicsImpostor = new BABYLON.PhysicsImpostor(ground, BABYLON.PhysicsImpostor.BoxImpostor, {mass: 0});
    });

    balls.forEach(ball => {
        ball.physicsImpostor = new BABYLON.PhysicsImpostor(ball, BABYLON.PhysicsImpostor.SphereImpostor, {mass: 5});
    });

	return scene;
};
